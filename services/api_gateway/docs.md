# API Gateway

## Общая информация

**API Gateway** — это центральный сервис маршрутизации, который управляет взаимодействием клиентов с микросервисами. Он предоставляет единый входной пункт для всех запросов от фронтенда и других клиентов, обеспечивая маршрутизацию, проверку API-ключей, балансировку нагрузки и контроль доступа.

### **Принцип работы**
1. **Фронтенд** отправляет запросы только в API Gateway, не зная о существовании отдельных микросервисов.
2. **API Gateway** анализирует запрос и перенаправляет его в нужный микросервис.
3. **Проверка API-ключа**: перед маршрутизацией запрос проходит проверку безопасности.
4. **Запрос отправляется в микросервис**, который выполняет логику и возвращает результат.
5. **API Gateway получает ответ** и передаёт его клиенту в унифицированном формате.

### **Основные возможности API Gateway:**
- **Маршрутизация**: отправка запросов в нужные микросервисы.
- **Проверка безопасности**: валидация API-ключей перед обработкой запроса.
- **Кэширование**: оптимизация работы и уменьшение нагрузки.
- **CORS и защита от атак**: контроль доступа между доменами.

---

## Архитектура API Gateway

API Gateway работает на **FastAPI** и управляет маршрутизацией между клиентами и сервисами. 

### **Основные компоненты:**
- **`routers/`** - модуль, содержащий маршруты ко всем микросервисам.
- **`main.py`** – Запуск FastAPI и регистрация маршрутов.
- **`Dockerfile`** – Контейнеризация API Gateway.

---

## Описание файлов

### `main.py`

Основной файл сервиса, отвечающий за запуск FastAPI, регистрацию маршрутов и подключение зависимостей.

#### **Основные компоненты:**
- **Инициализация FastAPI** и настройка CORS.
- **Регистрация маршрутов из `routers/`**.
- **Зависимость `check_api_key`** для защиты API.

---

### `Dockerfile`

Определяет, как контейнеризуется API Gateway в среде Docker.

---

### `routers/`

Содержит маршрутизацию к каждому микросервису:
- **`adventure_service/`** - маршруты для сервиса приключений.
- **`board_service/`** - маршруты для сервиса досок.
- **`party_service/`** - маршруты для сервиса команд.
- **`quest_service/`** - маршруты для сервиса задач.
- **`user_service/`** - маршруты для сервиса пользователей.

**Подробное описание маршрутов см. в документации `routers/`.**

---

## Взаимодействие API Gateway с микросервисами

### **Как запрос обрабатывается API Gateway:**
1. **Получение запроса** от клиента через REST API.
2. **Определение нужного маршрута** в `routers/`.
3. **Добавление заголовков (например, API-ключа или токена пользователя)**.
4. **Отправка запроса в соответствующий микросервис** через HTTP.
5. **Получение ответа от микросервиса** и обработка ошибок (например, 404, 500).
6. **Возвращение ответа клиенту** в стандартном JSON-формате.